<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω L·ªùi Ch√∫c</title>
    <link rel="stylesheet" href="style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .admin-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .admin-title {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }

        .password-form {
            margin-bottom: 30px;
        }

        .password-input-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .password-input {
            width: 50px;
            height: 60px;
            text-align: center;
            font-size: 24px;
            border: 2px solid #ddd;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .password-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .password-submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            display: block;
            transition: all 0.3s ease;
        }

        .password-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .password-error {
            color: #dc3545;
            text-align: center;
            margin-top: 10px;
            display: none;
        }

        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
        }

        .wishes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .wishes-count {
            font-size: 18px;
            color: #666;
        }

        .refresh-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .wishes-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .wish-item {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }

        .wish-item:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transform: translateX(5px);
        }

        .wish-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .wish-name {
            font-weight: bold;
            color: #667eea;
            font-size: 18px;
        }

        .wish-guest {
            color: #666;
            font-size: 14px;
            font-style: italic;
        }

        .wish-message {
            color: #333;
            line-height: 1.6;
            margin-bottom: 10px;
            white-space: pre-wrap;
        }

        .wish-date {
            color: #999;
            font-size: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .admin-container {
                padding: 20px;
            }

            .admin-title {
                font-size: 24px;
            }

            .password-input {
                width: 45px;
                height: 55px;
                font-size: 20px;
            }

            .wish-item {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <h1 class="admin-title">üîê Qu·∫£n L√Ω L·ªùi Ch√∫c</h1>
        
        <!-- Form nh·∫≠p m·∫≠t kh·∫©u -->
        <div class="password-form" id="passwordForm">
            <div class="password-input-group">
                <input type="text" class="password-input" id="pwd1" maxlength="1" pattern="[0-9]">
                <input type="text" class="password-input" id="pwd2" maxlength="1" pattern="[0-9]">
                <input type="text" class="password-input" id="pwd3" maxlength="1" pattern="[0-9]">
                <input type="text" class="password-input" id="pwd4" maxlength="1" pattern="[0-9]">
                <input type="text" class="password-input" id="pwd5" maxlength="1" pattern="[0-9]">
                <input type="text" class="password-input" id="pwd6" maxlength="1" pattern="[0-9]">
            </div>
            <button class="password-submit-btn" id="passwordSubmitBtn">X√°c Nh·∫≠n</button>
            <div class="password-error" id="passwordError">M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!</div>
        </div>

        <!-- N·ªôi dung qu·∫£n l√Ω -->
        <div class="admin-content" id="adminContent">
            <div class="wishes-header">
                <div class="wishes-count" id="wishesCount">ƒêang t·∫£i...</div>
                <button class="refresh-btn" id="refreshBtn">üîÑ L√†m m·ªõi</button>
            </div>
            
            <div class="wishes-list" id="wishesList">
                <div class="loading">ƒêang t·∫£i d·ªØ li·ªáu...</div>
            </div>
            
            <button class="logout-btn" id="logoutBtn">ƒêƒÉng xu·∫•t</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDlK6wJrOHVMYK1rHad2PiSj-X-GJYZjEI",
            authDomain: "birthdayinvi-cc08f.firebaseapp.com",
            databaseURL: "https://birthdayinvi-cc08f-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "birthdayinvi-cc08f",
            storageBucket: "birthdayinvi-cc08f.firebasestorage.app",
            messagingSenderId: "111670688222",
            appId: "1:111670688222:web:89a90a8f2a2d9c0465054f",
            measurementId: "G-LPY8B5FY1B"
        };

        // M·∫≠t kh·∫©u admin (6 s·ªë)
        const ADMIN_PASSWORD = "123456"; // Thay ƒë·ªïi m·∫≠t kh·∫©u n√†y

        // Kh·ªüi t·∫°o Firebase
        let database = null;
        if (typeof firebase !== 'undefined') {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
        }

        // DOM Elements
        const passwordForm = document.getElementById('passwordForm');
        const adminContent = document.getElementById('adminContent');
        const passwordInputs = [
            document.getElementById('pwd1'),
            document.getElementById('pwd2'),
            document.getElementById('pwd3'),
            document.getElementById('pwd4'),
            document.getElementById('pwd5'),
            document.getElementById('pwd6')
        ];
        const passwordSubmitBtn = document.getElementById('passwordSubmitBtn');
        const passwordError = document.getElementById('passwordError');
        const wishesList = document.getElementById('wishesList');
        const wishesCount = document.getElementById('wishesCount');
        const refreshBtn = document.getElementById('refreshBtn');
        const logoutBtn = document.getElementById('logoutBtn');

        // Ki·ªÉm tra ƒë√£ ƒëƒÉng nh·∫≠p ch∆∞a
        if (sessionStorage.getItem('adminLoggedIn') === 'true') {
            passwordForm.style.display = 'none';
            adminContent.classList.add('active');
            loadWishes();
        }

        // X·ª≠ l√Ω nh·∫≠p m·∫≠t kh·∫©u
        passwordInputs.forEach((input, index) => {
            input.addEventListener('input', function(e) {
                // Ch·ªâ cho ph√©p s·ªë
                this.value = this.value.replace(/[^0-9]/g, '');
                
                // T·ª± ƒë·ªông chuy·ªÉn sang √¥ ti·∫øp theo
                if (this.value && index < passwordInputs.length - 1) {
                    passwordInputs[index + 1].focus();
                }
            });

            input.addEventListener('keydown', function(e) {
                // X√≥a v√† chuy·ªÉn v·ªÅ √¥ tr∆∞·ªõc khi nh·∫•n Backspace
                if (e.key === 'Backspace' && !this.value && index > 0) {
                    passwordInputs[index - 1].focus();
                }
            });
        });

        // X·ª≠ l√Ω submit m·∫≠t kh·∫©u
        passwordSubmitBtn.addEventListener('click', function() {
            const password = passwordInputs.map(input => input.value).join('');
            
            if (password.length !== 6) {
                showPasswordError();
                return;
            }

            if (password === ADMIN_PASSWORD) {
                // ƒêƒÉng nh·∫≠p th√†nh c√¥ng
                sessionStorage.setItem('adminLoggedIn', 'true');
                passwordForm.style.display = 'none';
                adminContent.classList.add('active');
                loadWishes();
            } else {
                showPasswordError();
                // X√≥a m·∫≠t kh·∫©u
                passwordInputs.forEach(input => input.value = '');
                passwordInputs[0].focus();
            }
        });

        // Enter ƒë·ªÉ submit
        passwordInputs[5].addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                passwordSubmitBtn.click();
            }
        });

        function showPasswordError() {
            passwordError.style.display = 'block';
            setTimeout(() => {
                passwordError.style.display = 'none';
            }, 3000);
        }

        // Load danh s√°ch l·ªùi ch√∫c
        function loadWishes() {
            if (!database) {
                wishesList.innerHTML = '<div class="empty-state">L·ªói: Kh√¥ng th·ªÉ k·∫øt n·ªëi Firebase</div>';
                return;
            }

            wishesList.innerHTML = '<div class="loading">ƒêang t·∫£i d·ªØ li·ªáu...</div>';

            const wishesRef = database.ref('wishes');
            wishesRef.orderByChild('timestamp').once('value')
                .then((snapshot) => {
                    const wishes = [];
                    snapshot.forEach((childSnapshot) => {
                        wishes.push({
                            id: childSnapshot.key,
                            ...childSnapshot.val()
                        });
                    });

                    // S·∫Øp x·∫øp theo th·ªùi gian m·ªõi nh·∫•t
                    wishes.reverse();

                    displayWishes(wishes);
                })
                .catch((error) => {
                    console.error('L·ªói khi t·∫£i l·ªùi ch√∫c:', error);
                    wishesList.innerHTML = '<div class="empty-state">L·ªói khi t·∫£i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i!</div>';
                });
        }

        // Hi·ªÉn th·ªã danh s√°ch l·ªùi ch√∫c
        function displayWishes(wishes) {
            wishesCount.textContent = `T·ªïng s·ªë: ${wishes.length} l·ªùi ch√∫c`;

            if (wishes.length === 0) {
                wishesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <p>Ch∆∞a c√≥ l·ªùi ch√∫c n√†o</p>
                    </div>
                `;
                return;
            }

            wishesList.innerHTML = wishes.map(wish => {
                const date = wish.date ? new Date(wish.date).toLocaleString('vi-VN') : 'Kh√¥ng r√µ';
                const guestName = wish.guestName || 'Kh√°ch';
                const name = wish.name || '·∫®n danh';
                const message = wish.message || '';

                return `
                    <div class="wish-item">
                        <div class="wish-header">
                            <div>
                                <div class="wish-name">${escapeHtml(name)}</div>
                                <div class="wish-guest">Kh√°ch m·ªùi: ${escapeHtml(guestName)}</div>
                            </div>
                        </div>
                        <div class="wish-message">${escapeHtml(message)}</div>
                        <div class="wish-date">üìÖ ${date}</div>
                    </div>
                `;
            }).join('');
        }

        // Escape HTML ƒë·ªÉ tr√°nh XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // L√†m m·ªõi danh s√°ch
        refreshBtn.addEventListener('click', function() {
            loadWishes();
        });

        // ƒêƒÉng xu·∫•t
        logoutBtn.addEventListener('click', function() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                sessionStorage.removeItem('adminLoggedIn');
                passwordForm.style.display = 'block';
                adminContent.classList.remove('active');
                passwordInputs.forEach(input => input.value = '');
                passwordInputs[0].focus();
            }
        });

        // Auto focus v√†o √¥ ƒë·∫ßu ti√™n
        passwordInputs[0].focus();
    </script>
</body>
</html>

